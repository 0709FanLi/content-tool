# Nano Banana API 开发文档

## 节点信息

### Host地址
- **Host(海外)**: `https://api.grsai.com`
- **Host(国内直连)**: `https://grsai.dakka.com.cn`

### 使用方式
使用方式：Host + 接口路径

示例：
```
https://grsai.dakka.com.cn/v1/draw/nano-banana
```

---

## 支持的模型

1. **nano-banana-fast** - 快速版本
2. **nano-banana** - 标准版本

---

## 方式一：支持Gemini官方接口格式

### 说明
基础地址替换为Grsai的地址，模型名称 `gemini-2.5-flash-image` 改为 `nano-banana-fast`

### URL示例
```
https://grsai.dakka.com.cn/v1beta/models/nano-banana-fast:streamGenerateContent
```

---

## 方式二：Nano Banana绘画接口

### 接口信息
- **接口路径**: `/v1/draw/nano-banana`
- **请求方式**: `POST`
- **响应方式**: `stream` 或 `回调接口`

### 请求头 (Headers)
```json
{
  "Content-Type": "application/json",
  "Authorization": "Bearer apikey"
}
```

### 请求参数 (JSON)

#### 完整示例
```json
{
  "model": "nano-banana-fast",
  "prompt": "提示词",
  "aspectRatio": "auto",
  "urls": ["https://example.com/example.png"],
  "webHook": "https://example.com/callback",
  "shutProgress": false
}
```

#### 参数说明

| 参数名 | 类型 | 必填 | 示例 | 描述 |
|--------|------|------|------|------|
| model | string | 是 | `"nano-banana-fast"` | 支持模型: `nano-banana-fast`, `nano-banana` |
| prompt | string | 是 | `"一只可爱的猫咪在草地上玩耍"` | 提示词 |
| aspectRatio | string | 否 | `"auto"` | 输出图像比例，支持: `auto`, `1:1`, `16:9`, `9:16`, `4:3`, `3:4`, `3:2`, `2:3`, `5:4`, `4:5`, `21:9`。默认 `auto` |
| urls | array | 否 | `["https://example.com/example.png"]` | 参考图URL |
| webHook | string | 否 | `"https://your-webhook-url.com/callback"` | 进度与结果的回调链接<br/>- 接口默认以Stream流式响应进行回复<br/>- 如果填了webHook，进度与结果则以Post请求回调地址的方式进行回复<br/>- 请求头: `Content-Type: application/json`<br/>- 如果不使用回调，而使用轮询result接口方式获取结果，需要接口立即返回一个id，则webHook参数填 `"-1"`，那么会立即返回一个id |
| shutProgress | boolean | 否 | `false` | 关闭进度回复，直接回复最终结果，建议搭配webHook使用。默认 `false` |

### 响应结果

#### webHook结果 (使用流式响应请跳过该步骤)
当使用webHook回调时，请求后会立即返回一个id：

```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "id": "id"
  }
}
```

**webHook结果参数说明**:

| 参数名 | 类型 | 示例 | 描述 |
|--------|------|------|------|
| code | number | `0` | 状态码：0为成功 |
| msg | string | `"success"` | 状态信息 |
| data | object | - | 数据 |
| data.id | string | `"f44bcf50-f2d0-4c26-a467-26f2014a771b"` | 程序任务id，对应回调数据 |

#### 响应参数 (流式响应与webHook响应的参数)

```json
{
  "id": "xxxxx",
  "results": [
    {
      "url": "https://example.com/example.png",
      "content": "这是一只可爱的猫咪在草地上玩耍"
    }
  ],
  "progress": 100,
  "status": "succeeded",
  "failure_reason": "",
  "error": ""
}
```

**响应参数说明**:

| 参数名 | 类型 | 示例 | 描述 |
|--------|------|------|------|
| id | string | `"f44bcf50-f2d0-4c26-a467-26f2014a771b"` | Id (webHook回调可以用该id来对应数据) |
| results | array | `[{"url": "https://example.com/generated-image.jpg", "content": "这是一只可爱的猫咪在草地上玩耍"}]` | 结果<br/>- `content`: 回复内容<br/>- `url`: 图片URL(有效期为2小时) |
| progress | number | `100` | 任务进度, 0~100 |
| status | string | `"succeeded"` | 任务状态<br/>- `"running"`: 进行中<br/>- `"succeeded"`: 成功<br/>- `"failed"`: 失败 |
| failure_reason | string | `"error"` | 失败原因<br/>- `"output_moderation"`: 输出违规<br/>- `"input_moderation"`: 输入违规<br/>- `"error"`: 其他错误<br/><br/>当报错或者违规不出图时，会返还积分。<br/>提示：当触发"error"时，可尝试重新提交任务来确保系统稳定性。 |
| error | string | `"Invalid input parameters"` | 失败详细信息 |

---

## 方式三：获取结果接口

### 接口信息
- **接口路径**: `/v1/draw/result`
- **请求方式**: `POST`
- **说明**: 另外提供一个接口用于单独获取结果的接口（如有单独获取结果的需求，可以使用该接口）

### 请求参数

```json
{
  "id": "xxxxx"
}
```

### 响应结果

```json
{
  "code": 0,
  "data": {
    "id": "xxxxx",
    "results": [
      {
        "url": "https://example.com/example.png",
        "content": "这是一只可爱的猫咪在草地上玩耍"
      }
    ],
    "progress": 100,
    "status": "succeeded",
    "failure_reason": "",
    "error": ""
  },
  "msg": "success"
}
```

**响应参数说明**:

| 参数名 | 类型 | 示例 | 描述 |
|--------|------|------|------|
| code | number | `0` | 状态码：0成功, -22任务不存在 |
| msg | string | `"success"` | 状态信息 |
| data | object | - | 绘画结果，请参考上方的绘画结果的数据格式 |

---

## 使用场景说明

### 场景1: 流式响应
- 不设置 `webHook` 参数，接口会以Stream流式响应返回结果
- 实时接收进度和最终结果

### 场景2: WebHook回调
- 设置 `webHook` 参数为回调地址
- 接口立即返回任务id
- 进度和结果通过POST请求回调到指定地址

### 场景3: 轮询获取结果
- 设置 `webHook` 参数为 `"-1"`
- 接口立即返回任务id
- 使用 `/v1/draw/result` 接口轮询获取结果

---

## 注意事项

1. **图片有效期**: 生成的图片URL有效期为2小时
2. **积分返还**: 当报错或者违规不出图时，会返还积分
3. **错误处理**: 当触发"error"时，可尝试重新提交任务来确保系统稳定性
4. **认证**: 需要在请求头中携带 `Authorization: Bearer apikey`，其中 `apikey` 需要替换为实际的API密钥

